{
	"name": "Load_Sales",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "adl_raw_sales",
						"type": "DatasetReference"
					},
					"name": "sales"
				},
				{
					"dataset": {
						"referenceName": "adl_app_customers",
						"type": "DatasetReference"
					},
					"name": "customers"
				},
				{
					"dataset": {
						"referenceName": "adl_app_product",
						"type": "DatasetReference"
					},
					"name": "product"
				},
				{
					"dataset": {
						"referenceName": "adl_app_salesperson",
						"type": "DatasetReference"
					},
					"name": "salesPerson"
				},
				{
					"dataset": {
						"referenceName": "adl_app_shipmethod",
						"type": "DatasetReference"
					},
					"name": "shipmethod"
				},
				{
					"dataset": {
						"referenceName": "adl_app_territory",
						"type": "DatasetReference"
					},
					"name": "territory"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "adl_app_sales",
						"type": "DatasetReference"
					},
					"name": "appsales"
				}
			],
			"transformations": [
				{
					"name": "JoinCustomers"
				},
				{
					"name": "Aggregate"
				},
				{
					"name": "JoinProduct"
				},
				{
					"name": "JoinSalesperson"
				},
				{
					"name": "Joinshipmethod"
				},
				{
					"name": "JoinTerritory"
				}
			],
			"script": "source(output(\n\t\tSalesOrderID as string,\n\t\tOrderDate as string,\n\t\tDueDate as string,\n\t\tShipDate as string,\n\t\tStatus as string,\n\t\tOnlineOrderFlag as string,\n\t\tCustomerID as integer,\n\t\tSalesPersonID as integer,\n\t\tTerritoryID as integer,\n\t\tShipMethodID as integer,\n\t\tProductID as integer,\n\t\tOrderQty as float,\n\t\tUnitPrice as float,\n\t\tUnitPriceDiscount as float,\n\t\tLineTotal as float\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> sales\nsource(output(\n\t\tCustomerID as integer,\n\t\tPersonID as integer,\n\t\tStoreID as integer,\n\t\tTerritoryID as integer,\n\t\tAccountNumber as string,\n\t\tModifiedDate as timestamp,\n\t\tid_sk_customer as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> customers\nsource(output(\n\t\tProductID as integer,\n\t\tName as string,\n\t\tProductNumber as string,\n\t\tMakeFlag as integer,\n\t\tFinishedGoodsFlag as integer,\n\t\tColor as string,\n\t\tSafetyStockLevel as integer,\n\t\tReorderPoint as integer,\n\t\tStandardCost as float,\n\t\tListPrice as float,\n\t\tSize as string,\n\t\tSizeUnitMeasureCode as string,\n\t\tWeightUnitMeasureCode as string,\n\t\tWeight as decimal(10,0),\n\t\tDaysToManufacture as integer,\n\t\tProductLine as string,\n\t\tClass as string,\n\t\tStyle as string,\n\t\tProductModelID as integer,\n\t\tSellStartDate as timestamp,\n\t\tSellEndDate as timestamp,\n\t\tDiscontinuedDate as timestamp,\n\t\tProductCategory as string,\n\t\tProductSubcategory as string,\n\t\tid_sk_product as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinferDriftedColumnTypes: true,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> product\nsource(output(\n\t\tBusinessEntityID as integer,\n\t\tTerritoryID as integer,\n\t\tSalesQuota as float,\n\t\tBonus as float,\n\t\tCommissionPct as float,\n\t\tid_sk_salesperson as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> salesPerson\nsource(output(\n\t\tShipMethodID as integer,\n\t\tName as string,\n\t\tShipBase as float,\n\t\tShipRate as float,\n\t\trowguid as string,\n\t\tModifiedDate as timestamp,\n\t\tid_sk_shipmethod as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> shipmethod\nsource(output(\n\t\tTerritoryID as integer,\n\t\tName as string,\n\t\tCountryRegionCode as string,\n\t\tGroup as string,\n\t\tSalesYTD as float,\n\t\tSalesLastYear as float,\n\t\tCostYTD as string,\n\t\tCostLastYear as float,\n\t\trowguid as string,\n\t\tModifiedDate as timestamp,\n\t\tid_sk_territory as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> territory\nsales, customers join(sales@CustomerID == customers@CustomerID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinCustomers\nJoinTerritory aggregate(groupBy(id_sk_customer,\n\t\tOrderDate,\n\t\tid_sk_product,\n\t\tid_sk_salesperson,\n\t\tid_sk_shipmethod,\n\t\tid_sk_territory),\n\tOrderQty = sum(OrderQty),\n\t\tUnitPrice = sum(UnitPrice),\n\t\tUnitPriceDiscount = sum(UnitPriceDiscount),\n\t\tLineTotal = sum(LineTotal)) ~> Aggregate\nJoinCustomers, product join(sales@ProductID == product@ProductID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinProduct\nJoinProduct, salesPerson join(SalesPersonID == BusinessEntityID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinSalesperson\nJoinSalesperson, shipmethod join(sales@ShipMethodID == shipmethod@ShipMethodID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> Joinshipmethod\nJoinshipmethod, territory join(sales@TerritoryID == territory@TerritoryID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinTerritory\nAggregate sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tid_sk_customer as long,\n\t\tOrderDate as string,\n\t\tid_sk_product as long,\n\t\tid_sk_salesperson as long,\n\t\tid_sk_shipmethod as long,\n\t\tid_sk_territory as long,\n\t\tOrderQty as double,\n\t\tUnitPrice as double,\n\t\tUnitPriceDiscount as double,\n\t\tLineTotal as double\n\t),\n\tformat: 'parquet',\n\tpartitionFileNames:['sales.parquet'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('hash', 1)) ~> appsales"
		}
	}
}
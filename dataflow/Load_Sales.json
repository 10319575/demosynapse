{
	"name": "Load_Sales",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "adl_raw_sales",
						"type": "DatasetReference"
					},
					"name": "sales"
				},
				{
					"dataset": {
						"referenceName": "adl_app_customers",
						"type": "DatasetReference"
					},
					"name": "customers"
				},
				{
					"dataset": {
						"referenceName": "adl_app_product",
						"type": "DatasetReference"
					},
					"name": "product"
				},
				{
					"dataset": {
						"referenceName": "adl_app_salesperson",
						"type": "DatasetReference"
					},
					"name": "salesPerson"
				},
				{
					"dataset": {
						"referenceName": "adl_app_shipmethod",
						"type": "DatasetReference"
					},
					"name": "shipmethod"
				},
				{
					"dataset": {
						"referenceName": "adl_app_territory",
						"type": "DatasetReference"
					},
					"name": "territory"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "adl_app_sales",
						"type": "DatasetReference"
					},
					"name": "appsales"
				}
			],
			"transformations": [
				{
					"name": "JoinCustomers"
				},
				{
					"name": "Aggregate"
				},
				{
					"name": "JoinProduct"
				},
				{
					"name": "JoinSalesperson"
				},
				{
					"name": "Joinshipmethod"
				},
				{
					"name": "JoinTerritory"
				}
			],
			"script": "source(output(\n\t\tSalesOrderID as integer,\n\t\tOrderDate as string,\n\t\tDueDate as string,\n\t\tShipDate as string,\n\t\tStatus as short,\n\t\tOnlineOrderFlag as boolean,\n\t\tCustomerID as string,\n\t\tSalesPersonID as string,\n\t\tTerritoryID as string,\n\t\tShipMethodID as string,\n\t\tProductID as string,\n\t\tOrderQty as short,\n\t\tUnitPrice as double,\n\t\tUnitPriceDiscount as double,\n\t\tLineTotal as double\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> sales\nsource(output(\n\t\tCustomerID as string,\n\t\tPersonID as string,\n\t\tStoreID as string,\n\t\tTerritoryID as string,\n\t\tAccountNumber as string,\n\t\tModifiedDate as string,\n\t\tid_sk_customer as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> customers\nsource(output(\n\t\tProductID as string,\n\t\tName as string,\n\t\tProductNumber as string,\n\t\tMakeFlag as string,\n\t\tFinishedGoodsFlag as string,\n\t\tColor as string,\n\t\tSafetyStockLevel as string,\n\t\tReorderPoint as string,\n\t\tStandardCost as string,\n\t\tListPrice as string,\n\t\tSize as string,\n\t\tSizeUnitMeasureCode as string,\n\t\tWeightUnitMeasureCode as string,\n\t\tWeight as string,\n\t\tDaysToManufacture as string,\n\t\tProductLine as string,\n\t\tClass as string,\n\t\tStyle as string,\n\t\tProductModelID as string,\n\t\tSellStartDate as string,\n\t\tSellEndDate as string,\n\t\tDiscontinuedDate as string,\n\t\tProductCategory as string,\n\t\tProductSubcategory as string,\n\t\tid_sk_product as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinferDriftedColumnTypes: true,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> product\nsource(output(\n\t\tBusinessEntityID as string,\n\t\tTerritoryID as string,\n\t\tSalesQuota as string,\n\t\tBonus as string,\n\t\tCommissionPct as string,\n\t\tid_sk_salesperson as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> salesPerson\nsource(output(\n\t\tShipMethodID as string,\n\t\tName as string,\n\t\tShipBase as string,\n\t\tShipRate as string,\n\t\trowguid as string,\n\t\tModifiedDate as string,\n\t\tid_sk_shipmethod as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> shipmethod\nsource(output(\n\t\tTerritoryID as string,\n\t\tName as string,\n\t\tCountryRegionCode as string,\n\t\tGroup as string,\n\t\tSalesYTD as string,\n\t\tSalesLastYear as string,\n\t\tCostYTD as string,\n\t\tCostLastYear as string,\n\t\trowguid as string,\n\t\tModifiedDate as string,\n\t\tid_sk_territory as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> territory\nsales, customers join(sales@CustomerID == customers@CustomerID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinCustomers\nJoinTerritory aggregate(groupBy(id_sk_customer,\n\t\tOrderDate,\n\t\tid_sk_product,\n\t\tid_sk_salesperson,\n\t\tid_sk_shipmethod,\n\t\tid_sk_territory),\n\tOrderQty = sum(OrderQty),\n\t\tUnitPrice = sum(UnitPrice),\n\t\tUnitPriceDiscount = sum(UnitPriceDiscount),\n\t\tLineTotal = sum(LineTotal)) ~> Aggregate\nJoinCustomers, product join(sales@ProductID == product@ProductID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinProduct\nJoinProduct, salesPerson join(SalesPersonID == BusinessEntityID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinSalesperson\nJoinSalesperson, shipmethod join(sales@ShipMethodID == shipmethod@ShipMethodID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> Joinshipmethod\nJoinshipmethod, territory join(sales@TerritoryID == territory@TerritoryID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinTerritory\nAggregate sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tCustomerID as string,\n\t\tPersonID as string,\n\t\tStoreID as string,\n\t\tTerritoryID as string,\n\t\tAccountNumber as string,\n\t\tModifiedDate as string,\n\t\tid_sk_customer as long\n\t),\n\tformat: 'parquet',\n\tpartitionFileNames:['sales.parquet'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('hash', 1)) ~> appsales"
		}
	}
}